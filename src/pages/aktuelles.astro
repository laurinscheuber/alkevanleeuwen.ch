---
import Layout from '../layouts/Layout.astro';
import { client, urlFor } from '../lib/sanity';

const projects = await client.fetch(`*[_type == "project"]{
    title,
    "description": pt::text(description),
    slug,
    date,
    mainImage
} | order(date asc)`);
---

<Layout title="Aktuelles - Physiotherapie Alke van Leeuwen">
  <section class="section" style="padding-top: 2rem;">
    <div class="container">
      <h1 class="text-center" style="margin-bottom: 2rem;">Aktuelles</h1>
      
      {projects.length === 0 ? (
        <p class="text-center" style="color: var(--color-text-light);">Momentan keine aktuellen Projekte.</p>
      ) : (
        <div class="news-grid">
          {projects.map((project) => {
             const dateStr = project.date ? new Date(project.date).toLocaleDateString('de-CH', { 
                day: '2-digit', month: '2-digit', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
             }) : '';
             
             return (
              <a href={`/aktuelles/${project.slug?.current}`} class="project-card-link">
                <article class="project-card">
                    {project.mainImage && (
                      <div class="image-wrapper">
                        <img src={urlFor(project.mainImage).width(400).height(250).url()} alt={project.title} class="project-image" loading="lazy" />
                      </div>
                    )}
                    <div class="project-content">
                        <h3 class="project-title">{project.title}</h3>
                        <p class="project-meta">
                            {dateStr && (<span><strong>Termin:</strong> {dateStr} Uhr</span>)}
                        </p>
                        <p class="project-description line-clamp-3">{project.description || ''}</p>
                    </div>
                </article>
              </a>
             );
          })}
        </div>
      )}
    </div>
  </section>
</Layout>

<style>
  .news-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
  }
  
  .project-card-link {
    text-decoration: none;
    color: inherit;
    display: block;
    height: 100%;
  }

  .project-card {
    background: white;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .project-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-md);
  }
  
  .image-wrapper {
    height: 200px;
    overflow: hidden;
  }
  
  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .project-card:hover .project-image {
    transform: scale(1.05);
  }
  
  .project-content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .project-title {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    color: var(--color-primary-dark);
  }
  
  .project-meta {
    font-size: 0.9rem;
    color: var(--color-text-light);
    margin-bottom: 1rem;
    line-height: 1.4;
  }
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
